<!doctype html>
<html lang="fr" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Avril â€” Proposer un mot</title>
    <meta name="description" content="Page simple qui propose un mot alÃ©atoire depuis un fichier texte du dÃ©pÃ´t." />
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E%F0%9F%93%9D%3C/text%3E%3C/svg%3E" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root { --blur: 10px }
      .glass { backdrop-filter: blur(var(--blur)); -webkit-backdrop-filter: blur(var(--blur)); background: rgba(255,255,255,0.6) }
      .dark .glass { background: rgba(17,24,39,0.6) }
      .btn { @apply px-4 py-2 rounded-2xl shadow hover:shadow-md transition font-medium; }
      .btn-primary { @apply bg-indigo-600 text-white hover:bg-indigo-700; }
      .btn-secondary { @apply bg-white text-gray-900 hover:bg-gray-100 border border-gray-200; }
      .tag { @apply inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-sm font-medium text-gray-800; }
    </style>
  </head>
  <body class="min-h-full bg-gradient-to-br from-indigo-50 via-sky-50 to-emerald-50 dark:from-slate-900 dark:via-slate-900 dark:to-slate-800 text-slate-800 dark:text-slate-100">
    <main class="mx-auto max-w-2xl p-6">
      <header class="flex items-center justify-between mb-6">
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Avril Â· Proposer un mot</h1>
        <button id="toggleTheme" class="btn btn-secondary" title="Basculer clair/sombre">ðŸŒ“</button>
      </header>

      <section class="glass rounded-3xl p-6 shadow">
        <p class="text-sm text-gray-700 dark:text-gray-300 mb-4">
          Cette page lit un fichier texte <code class="font-mono">mots.txt</code> (une ligne = un mot) situÃ© Ã  la racine du dÃ©pÃ´t, puis renvoie un mot au hasard.
        </p>

        <div class="flex flex-wrap items-center gap-2 mb-4">
          <span id="metaCount" class="tag hidden"></span>
          <span id="metaSource" class="tag">SourceÂ : <span class="ml-1 font-mono">/mots.txt</span></span>
        </div>

        <div class="flex gap-3">
          <button id="btnProposer" class="btn btn-primary">Proposer un mot</button>
          <button id="btnCopier" class="btn btn-secondary" title="Copier le mot" disabled>Copier</button>
        </div>

        <div id="zoneMot" class="mt-6 rounded-3xl border border-gray-200 bg-white/70 dark:bg-slate-800/60 p-6 min-h-[120px] flex items-center justify-center text-center">
          <span id="mot" class="text-3xl md:text-4xl font-bold select-text">â€”</span>
        </div>

        <div id="zoneErreur" class="hidden mt-4 rounded-xl border border-red-300 bg-red-50 dark:bg-red-900/30 p-4 text-red-700 dark:text-red-300 text-sm"></div>
      </section>

      <footer class="mt-10 text-center text-sm text-gray-500">
        <p>HÃ©bergÃ© sur GitHub Pages Â· Placez votre liste dans <code class="font-mono">/mots.txt</code>.</p>
      </footer>
    </main>

    <script>
      // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      //  Helpers & state
      // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      const $ = (id) => document.getElementById(id)
      const S = {
        words: [],
        loaded: false
      }

      // ThÃ¨me
      const toggleTheme = $('toggleTheme')
      toggleTheme?.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark')
        localStorage.setItem('avril_theme_dark', document.documentElement.classList.contains('dark') ? '1' : '0')
      })
      if (localStorage.getItem('avril_theme_dark') === '1') document.documentElement.classList.add('dark')

      // Elements
      const btnProposer = $('btnProposer')
      const btnCopier   = $('btnCopier')
      const spanMot     = $('mot')
      const zoneErreur  = $('zoneErreur')
      const metaCount   = $('metaCount')

      // Verrouille le bouton tant que la liste n'est pas chargÃ©e
      btnProposer.disabled = true
      btnProposer.title = 'Chargement de motsâ€¦'

      function showError(msg) {
        zoneErreur.textContent = msg
        zoneErreur.classList.remove('hidden')
      }
      function hideError() { zoneErreur.classList.add('hidden'); zoneErreur.textContent = '' }

      // Charge le fichier /mots.txt (Ã  la racine du dÃ©pÃ´t)
      async function chargerMots() {
        try {
          const url = './mots.txt?v=' + Date.now() // bust cache
          const res = await fetch(url, { cache: 'no-store' })
          if (!res.ok) throw new Error('mots.txt introuvable (' + res.status + '). Placez un fichier Ã  la racine du repo.')
          const text = await res.text()
          const arr = text.split(/\r?\n/).map(l => l.trim()).filter(l => l && !l.startsWith('#'))
          const unique = Array.from(new Set(arr))
          if (unique.length === 0) throw new Error('mots.txt est vide (ou uniquement des commentaires).')
          S.words = unique
          S.loaded = true
          btnProposer.disabled = false
          btnProposer.title = ''
          metaCount.textContent = unique.length + ' mots'
          metaCount.classList.remove('hidden')
          hideError()
          console.info('[Avril] mots chargÃ©s :', unique.length)
        } catch (e) {
          console.error('[Avril] erreur chargement:', e)
          btnProposer.disabled = true
          showError(e.message + '\n\nVÃ©rifiez que le fichier s\'appelle exactement "mots.txt" et se trouve Ã  la racine. Si votre site est publiÃ© dans /docs, placez-le aussi dans /docs.')
        }
      }

      function proposer() {
        if (!S.loaded || !S.words.length) { showError('La liste n\'est pas chargÃ©e.'); return }
        const i = Math.floor(Math.random() * S.words.length)
        const mot = S.words[i]
        spanMot.textContent = mot
        btnCopier.disabled = false
      }

      function copier() {
        const text = spanMot.textContent
        if (!text || text === 'â€”') return
        navigator.clipboard.writeText(text).then(() => {
          btnCopier.textContent = 'CopiÃ© !'
          setTimeout(() => btnCopier.textContent = 'Copier', 1200)
        }).catch(() => {
          showError('Impossible de copier automatiquement. SÃ©lectionnez le mot et copiezâ€‘le manuellement.')
        })
      }

      btnProposer.addEventListener('click', proposer)
      btnCopier.addEventListener('click', copier)

      // DÃ©marrage aprÃ¨s chargement du DOM (sÃ©curitÃ©)
      document.addEventListener('DOMContentLoaded', () => {
        chargerMots()
      })
    </script>
  </body>
</html>
